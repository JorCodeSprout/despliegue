services:
  # 1. Servicio Backend PHP-FPM (Laravel)
  - type: web
    name: laravel-api # Cambiado de 'app' para coincidir con tu panel
    env: docker
    dockerfilePath: docker/php/Dockerfile
    dockerContext: .
    autoDeploy: true
    branch: main
    
    internal: true
    ports: 
      - 9000 # Solo necesitamos exponer el puerto FPM
      
    startCommand: "sh /usr/local/bin/render-entrypoint-dual.sh" # Usa el script correcto
    healthCheckPath: /api/health 

    # Variables de Entorno de Laravel
    envVars:
      # ... (variables de DB)
      - key: DB_CONNECTION
        value: mysql
      - key: APP_KEY
        generateValue: true
      - key: APP_ENV
        value: production
      # NGINX_HOST ya no es necesario aquí, Nginx lo maneja

  # 2. Servicio Web Nginx (El Punto de Entrada Público)
  - type: web
    name: ritmatiza # Coincide con tu panel
    env: docker
    dockerfilePath: docker/nginx/Dockerfile
    dockerContext: .
    autoDeploy: true
    branch: main
    
    envVars:
      - key: APP_URL
        value: https://${ritmatiza.host} 
      # Se asume que VITE_API_URL es pasado como ARG en el Dockerfile de Nginx

    healthCheckPath: /health.html